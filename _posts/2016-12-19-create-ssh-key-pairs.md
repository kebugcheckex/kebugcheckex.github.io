---
layout: post
title: Creating SSH Key Pairs
tags: [Linux, DevOps]
---

It is very common to connect to remote servers via SSH. There are two authentication methods when using SSH, password and key pairs. The latter is more secure. This article describes how to generate SSH key pairs and copy the public keys to remote servers.

## 1. Generate SSH Key Pairs

### Linux/Mac OS

On Linux and Mac OS, there is a built-in tool, `ssh-keygen`, to generate key pairs. The simplest usage of `ssh-keygen` with no arguments generates a pair of RSA keys for SSH protocol 2 use. Optionally, during the generation process, you can specify a passphrase for your private key so that your key will not be compromised even if the key file itself is stolen. The private key is named `id_rsa` and the public key is named `id_rsa.pub`. Both files are placed in `~/.ssh/` by default.

If you are generating key pairs for someone else, the `-f` option can be used to specify the location where the generated key pairs will be placed.

```
ssh-keygen -t rsa -f /path/to/output/file
```
_Note: the /path/to/output/file is just a placeholder. You should replace it with your path._
By default, SSH clients search the `~/.ssh/` folder for key files. If your key files are placed somewhere else, you can use the `-i` option to specify the path to the key file. Note that key files are required to be protected by file permissions. That means, only the owner can read/write the key file. You can use `chmod` command to change the file permissions.

```
chmod 600 /path/to/key/files
```
_Note: the /path/to/output/file is just a placeholder. You should replace it with your path._

You do not need to do this if the key pairs are generated by `ssh-keygen` as it does that for you.

> #### Bonus: What is randomart
> After generating the key pairs, `ssh-keygen` will display an ASCII image. That is called the randomart. If you are wondering what that is for, please read [this post](http://superuser.com/questions/22535/what-is-randomart-produced-by-ssh-keygen).

### Windows

Windows does not have any built-in facility for generating key pairs. The most popular SSH key generator is called `puttygen`. You can download it from [this page](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html).

![putty](/img/puttygen-wine.png)

`puttygen` does not use system random number generator. Instead, it needs the user's help to generate randomness. Once you open `puttygen`, click on `Generate`. Then move your mouse cursor around in the blank area on the top. When it collects enough data, a pair of keys will be generated. Copy the content in the top part where you just moved your mouse cursor. That is the public key. Paste the content into a file for future use. To save the private key, click on the menu bar _Conversions_, then choose _export OpenSSH key_. `puttygen` will warn you that no passprase is set. You can ignore that.

Some SSH clients uses the PPK format. You can save the key in PPK format by clicking the _Save private key_ button in `puttygen`.

## 2. Copy the Public Key to the Server

### Linux/Mac OS

On Linux and Mac OS, there is a built-in tool, `ssh-copy-id`, that is able to copy your public key to a remote machine. The simple form is show below, provided that your public key is placed in the default location `~/.ssh/id_rsa.pub`

```
ssh-copy-id username@hostname
```

During the process, you will be prompted to enter the password to login to the remote machine first. Sometimes login via password is disabled on the remote machine. In this case, you need ask the system administrator to help you copy your public key into your profile so that you can login via keys.

### Windows

Unfortunately Windows does not have an `ssh-copy-id` utility. However, copying keys to the server can be done manually. Hopefully you still have your `puttygen` window open. You can copy the public key in the top part of the window where you moved your mouse cursor around to generate the key. Then log into the remote machine via SSH. At this point, you need to type your password since you have not set up your public key yet. In your home folder, create a directory named `.ssh` if it does not exist.

```
mkdir -p ~/.ssh/
```

Enter the directory and use any text editor to create a file named `authorized_keys`. Paste your public key into the file. Normally the public key consists of three parts, starting with `ssh-rsa` and then a string of encoded key followed by an optional comment. The three parts are delimited by space. Here is an example:

```
ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEAzWJF34ochyfFYidIFHm3b/5ivYap5vpPh67YAKrKrUZuR/iVDKLBf05ECZFg7G9qyQwPIAcJRtWi+ltu/Q/ky8vhukIBK39wJHzvI5s5GFDaq7ste4SQ4CSMMH48i35e4DYBXXdFEZToGgnDw6Tj1m9FuroZ1y2TL3NpkCJzbgy4gktrsMyq8GpVhlXPxa6SIGkbyLIAiNGlmPSkUpKPGVg1Sb2efwVaC/P85ud0XX34QimDoJkUKp1IebK91hWerINiB8ggfBVhAQmsKXDbnHboqeXLQMp92518CSJNyWet05RYGAvXs7yykDkkObkhwzfLfIkhu265QLnepgCtdw== rsa-key-20161220
```

Save the file and change the permission to 600, which means it can only be read/written by the owner of this file. Now you can login to the remote machine using SSH keys.
